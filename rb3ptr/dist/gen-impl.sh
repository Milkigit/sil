#!/bin/sh

set -e

{
# code duplication. These definitions are preprocessor definitions in
# defs.h
cat <<EOF
/*
 * This file was autogenerated with gen-impl.sh
 *
 * Autogenerated from git commit $(git rev-parse HEAD)
 */

#define _RB3_API extern
#define _RB3_API_STATIC_INLINE static inline __attribute__((unused))
#define _RB3_COLD __attribute__((cold))
#define _RB3_INLINE inline __attribute__((always_inline))
#define _RB3_NEVERINLINE __attribute__((noinline))
EOF

for i in defs.c types.c internal.c navigate.c basic.c ; do
	cat templates/"$i"
done
} > build/rb3ptr-impl.h

{
cat <<EOF
/*
 * This file was autogenerated with gen-impl.sh
 *
 * Autogenerated from git commit $(git rev-parse HEAD)
 *
 * Compile with
 *     cc -c -std=c99 -Wall -Wextra -O2
 */

#include "rb3ptr-impl.h"

EOF

cat templates/impl.c
} > build/rb3ptr-impl.c
